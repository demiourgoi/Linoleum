name: linoleum

on:
  push:
    branches: [ "*" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build:

    runs-on: ubuntu-latest
    defaults:
      run:
        working-directory: ./
    permissions:
      contents: read

    # This build is a simplification of .github/workflows/ci.yml
    # as generated by `sbt githubWorkflowGenerate`from https://github.com/sbt/sbt-github-actions
    steps:
      - name: Set up JDK 20
        uses: actions/setup-java@v4
        with:
          java-version: '20'
          distribution: 'temurin'

      - name: Setup sbt
        uses: sbt/setup-sbt@v1

      # Reenable only if we want to use an unreleased branch
      # - name: Checkout sscheck-core
      #   uses: actions/checkout@v4
      #   with:
      #     repository: 'demiourgoi/sscheck-core'
      #     ref: '0.5.1-scala'

      # - name: Build and publish sscheck-core
      #   run: sbt clean publishM2

      - name: Checkout current branch
        uses: actions/checkout@v4

      # See the Gradle build scan link in the "build summary" of the github actions run
      - name: Build and publish linoleum
        run: cd ./linoleum && chmod +x gradlew && make release EXTRA_BUILD_ARGS=--scan

      # See the Gradle build scan link in the "build summary" of the github actions run
      - name: Build linoleum-ltlss-examples
        run: cd ./linoleum-ltlss-examples && chmod +x gradlew && make release EXTRA_BUILD_ARGS=--scan
